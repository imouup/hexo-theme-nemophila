<div id="tweet">
    <img src="<%- url_for(theme.aboutme.avatar) %>" alt="Tweet Avatar" id="tweet-avatar" draggable="false">
    <div id="tweet-content">
        <div id="tweet-info">
            <span id="author-name"><%= config.author_name_in_mother_tongue %></span>
            <span id="tweet-time"> Just now  </span>
        </div>
        <p id="tweet-text">我们虽然距离很远很远，非常非常的远，但是思念或许真的可以穿越时间和距离。</p>
    </div>
    <script>
        (function() {
            let apiUrl = "<%- theme.tweet.api || '' %>";
            if (!apiUrl) return;

            function formatTime(timeStr) {
                if (!timeStr) return '';
                const date = new Date(timeStr);
                const now = new Date();
                const diff = (now - date) / 1000; // seconds

                if (diff < 60) {
                    return 'Just now';
                } else if (diff < 3600) {
                    return Math.floor(diff / 60) + ' minutes ago';
                } else if (diff < 86400) {
                    return Math.floor(diff / 3600) + ' hours ago';
                } else {
                    return date.toLocaleString(); // 显示为当地日期和时间
                }
            }

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    let text = data.hitokoto || data.text || data.content;
                    let time = data.created_at || data.date || data.time;

                    if (text) {
                        document.getElementById('tweet-text').innerText = text;
                    }
                    if (time) {
                        document.getElementById('tweet-time').innerText = formatTime(time);
                    }
                })
                .catch(err => {
                    console.warn('Tweet API fetch failed:', err);
                });
        })();
    </script>
</div>